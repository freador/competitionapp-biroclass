<% cancel_path = local_assigns.fetch(:cancel_path, user.new_record? ? root_path : profile_path) %>
<% form_url = user.new_record? ? users_path : profile_path %>
<% form_method = user.new_record? ? :post : :patch %>

<%= form_with(model: user, url: form_url, method: form_method, class: "space-y-6") do |form| %>
  <% if user.errors.any? %>
    <div class="rounded-2xl border border-rose-200 bg-rose-50 p-4" role="alert">
      <div class="flex items-center gap-2 mb-2">
        <svg class="h-5 w-5 text-rose-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <use href="#heroicon-x" />
        </svg>
        <h3 class="text-sm font-semibold text-rose-900">
          <%= pluralize(user.errors.count, "erro") %> impediu que este usuário fosse salvo:
        </h3>
      </div>
      <ul class="ml-7 list-disc space-y-1 text-sm text-rose-700">
        <% user.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="rounded-3xl border border-slate-100 bg-white p-6 shadow-xl">
    <div class="space-y-5">
      <%= render "shared/form_field",
          form: form,
          field: :name,
          label: "Nome Completo",
          type: "text",
          required: true,
          autofocus: true,
          placeholder: "João Silva",
          help_text: "Nome completo do usuário" %>

      <%= render "shared/form_field",
          form: form,
          field: :email,
          label: "Email",
          type: "email",
          required: true,
          placeholder: "joao@exemplo.com",
          help_text: "Email único para acesso ao sistema" %>

      <div class="rounded-2xl border border-indigo-100 bg-indigo-50/50 p-4">
        <p class="text-xs font-semibold uppercase tracking-wide text-indigo-900 mb-4">Senha</p>

        <div class="space-y-4">
          <%= render "shared/form_field",
              form: form,
              field: :password,
              label: "Senha",
              type: "password",
              required: user.new_record?,
              placeholder: "••••••••",
              help_text: (user.new_record? ? "Mínimo de 6 caracteres" : "Deixe em branco para manter a senha atual") %>

          <%= render "shared/form_field",
              form: form,
              field: :password_confirmation,
              label: "Confirmar Senha",
              type: "password",
              required: user.new_record?,
              placeholder: "••••••••",
              help_text: "Digite a senha novamente para confirmar" %>
        </div>
      </div>
    </div>

    <div class="mt-6 flex flex-wrap gap-3 pt-6 border-t border-slate-200">
      <%= form.submit (user.new_record? ? "Criar conta" : "Atualizar perfil"), class: "inline-flex items-center gap-2 rounded-full bg-indigo-600 px-6 py-3 text-sm font-semibold uppercase tracking-wide text-white shadow-lg shadow-indigo-500/30 transition-all duration-200 hover:bg-indigo-500 hover:shadow-xl active:scale-95" %>

      <%= link_to "Cancelar", cancel_path, class: "inline-flex items-center gap-2 rounded-full border border-slate-300 px-6 py-3 text-sm font-semibold uppercase tracking-wide text-slate-700 transition-all duration-200 hover:bg-slate-50 hover:border-slate-400 active:scale-95" %>
    </div>
  </div>
<% end %>
