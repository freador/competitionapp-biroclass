<% note.participant ||= participant %>
<%= turbo_frame_tag dom_id(participant, :judging_card) do %>
  <article class="h-full rounded-3xl border border-slate-100 bg-white p-6 shadow-sm">
    <div class="flex items-start justify-between gap-4">
      <div>
        <p class="text-xs uppercase tracking-[0.3em] text-indigo-400">Participante</p>
        <h3 class="text-xl font-semibold text-slate-900"><%= participant.display_name %></h3>
        <% if participant.user&.email.present? %>
          <p class="text-xs text-slate-500"><%= participant.user.email %></p>
        <% end %>
      </div>
      <% if note.persisted? %>
        <span class="rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-600">Nota enviada</span>
      <% else %>
        <span class="rounded-full bg-amber-50 px-3 py-1 text-xs font-semibold text-amber-600">Pendente</span>
      <% end %>
    </div>

    <div class="mt-4 rounded-2xl border border-slate-100 bg-slate-50 p-4">
      <%= form_with model: [competition, note], class: "space-y-3" do |form| %>
        <%= form.hidden_field :participant_id, value: participant.id %>
        <div>
          <%= form.label :score, "Nota (0 a 10)", class: "text-sm font-semibold text-slate-700" %>
          <%= form.number_field :score,
                min: 0,
                max: 10,
                step: 1,
                class: "mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-lg font-semibold text-slate-900 focus:border-indigo-400 focus:ring-indigo-200",
                required: true %>
        </div>
        <div>
          <%= form.label :comment, "ComentÃ¡rio (opcional)", class: "text-sm font-semibold text-slate-700" %>
          <%= form.text_area :comment,
                rows: 3,
                class: "mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-indigo-400 focus:ring-indigo-200",
                placeholder: "Compartilhe seus feedbacks" %>
        </div>

        <% if note.errors.any? %>
          <div class="rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm font-semibold text-rose-700">
            <%= note.errors.full_messages.to_sentence %>
          </div>
        <% end %>

        <div class="flex items-center justify-between gap-3">
          <% if note.persisted? && note.updated_at.present? %>
            <p class="text-xs text-slate-400">
              Atualizada em <%= l note.updated_at, format: :short %>
            </p>
          <% end %>
          <%= form.submit(note.persisted? ? "Atualizar nota" : "Enviar nota",
                class: "ml-auto inline-flex items-center rounded-full bg-indigo-600 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white shadow-lg shadow-indigo-500/30 transition hover:bg-indigo-500") %>
        </div>
      <% end %>
    </div>
  </article>
<% end %>
