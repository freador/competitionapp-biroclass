<% steps = Competitions::WizardController::STEPS %>
<% titles = { "details" => "Detalhes", "judges" => "Jurados", "participants" => "Participantes" } %>
<% descriptions = {
  "details" => "Conte ao mundo sobre sua competição.",
  "judges" => "Convide jurados informando os emails.",
  "participants" => "Cadastre participantes iniciais para montar o ranking."
} %>
<% current_index = steps.index(@step) || 0 %>
<% previous_step = current_index.positive? ? steps[current_index - 1] : nil %>

<section class="grid gap-8 lg:grid-cols-[280px,1fr]">
  <aside class="rounded-3xl border border-slate-100 bg-white/70 p-6 shadow-lg">
    <p class="text-xs uppercase tracking-[0.3em] text-indigo-400">Passo a passo</p>
    <ul class="mt-6 space-y-4">
      <% steps.each_with_index do |step, index| %>
        <li class="flex items-start gap-3">
          <% status_class = if index < current_index
              "bg-emerald-500"
            elsif index == current_index
              "bg-indigo-500"
            else
              "bg-slate-300"
            end %>
          <span class="mt-1 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-semibold text-white <%= status_class %>"><%= index + 1 %></span>
          <div>
            <p class="text-sm font-semibold text-slate-800"><%= titles[step] %></p>
            <p class="text-xs text-slate-500"><%= descriptions[step] %></p>
          </div>
        </li>
      <% end %>
    </ul>
  </aside>

  <div class="space-y-8">
    <header>
      <p class="text-sm uppercase tracking-[0.3em] text-indigo-400"><%= titles[@step] %></p>
      <h1 class="mt-2 text-3xl font-semibold text-slate-900">Configure a competição</h1>
      <p class="mt-2 text-slate-500"><%= descriptions[@step] %></p>
    </header>

    <div class="rounded-3xl border border-slate-100 bg-white p-8 shadow-xl">
      <%= form_with url: competition_builder_path, method: :patch, class: "space-y-6" do |form| %>
        <%= hidden_field_tag :step, @step %>

        <% if @step == "details" %>
          <div>
            <%= form.label :title, "Nome da competição", class: "text-sm font-semibold text-slate-700" %>
            <%= form.text_field :title, name: "competition[title]", value: @competition.title, required: true, class: "mt-2 w-full rounded-2xl border border-slate-200 px-4 py-2.5 text-slate-900 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" %>
          </div>
          <div>
            <%= form.label :description, "Descrição", class: "text-sm font-semibold text-slate-700" %>
            <%= form.text_area :description, name: "competition[description]", rows: 4, value: @competition.description, class: "mt-2 w-full rounded-2xl border border-slate-200 px-4 py-2.5 text-slate-900 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" %>
          </div>
          <div>
            <%= form.label :rules, "Regras ou instruções", class: "text-sm font-semibold text-slate-700" %>
            <%= form.text_area :rules, name: "competition[rules]", rows: 5, value: @competition.rules, class: "mt-2 w-full rounded-2xl border border-slate-200 px-4 py-2.5 text-slate-900 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" %>
          </div>
        <% elsif @step == "judges" %>
          <div>
            <label class="text-sm font-semibold text-slate-700">Emails dos jurados</label>
            <p class="mt-1 text-sm text-slate-500">Digite um email por linha e compartilhe o link gerado para cada jurado.</p>
            <%= text_area_tag :judge_emails, @judge_emails, rows: 8, class: "mt-3 w-full rounded-2xl border border-slate-200 px-4 py-2.5 text-slate-900 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" %>
          </div>
        <% elsif @step == "participants" %>
          <div class="grid gap-6 lg:grid-cols-2">
            <div>
              <label class="text-sm font-semibold text-slate-700">Participantes</label>
              <p class="mt-1 text-sm text-slate-500">Informe um participante por linha (ex.: "Ana Silva &lt;ana@email.com&gt;"). Email é opcional, mas facilita o compartilhamento do link.</p>
              <%= text_area_tag :participant_names, @participant_names, rows: 10, class: "mt-3 w-full rounded-2xl border border-slate-200 px-4 py-2.5 text-slate-900 shadow-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" %>
            </div>
              <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4 text-sm text-slate-600">
                <p class="font-semibold text-slate-800">Resumo</p>
                <ul class="mt-3 space-y-2">
                  <li><strong>Título:</strong> <%= @competition.title.presence || "—" %></li>
                  <li><strong>Descrição:</strong> <%= truncate(@competition.description.to_s, length: 120) %></li>
                  <li><strong>Jurados:</strong> <%= (@wizard["judges"] || []).length %> convidado(s)</li>
                  <li><strong>Participantes:</strong> <%= Array(@wizard["participants"]).size %> cadastrado(s)</li>
                </ul>
              </div>
            </div>
        <% end %>

        <div class="flex flex-wrap gap-3">
          <% if previous_step.present? %>
            <%= link_to "Voltar", competition_builder_path(step: previous_step), class: "inline-flex items-center rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600 hover:border-slate-400" %>
          <% end %>
          <% button_label = (@step == "participants") ? "Criar competição" : "Continuar" %>
          <%= form.submit button_label, class: "inline-flex items-center rounded-full bg-indigo-600 px-5 py-2.5 text-sm font-semibold text-white shadow-lg shadow-indigo-500/30 transition hover:bg-indigo-500" %>
        </div>
      <% end %>
    </div>
  </div>
</section>
